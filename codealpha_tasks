import java.util.*;
import java.io.*;

class Student {
    private String name;
    private int rollNo;
    private int tamil, english, maths, science, social;
    private int total;
    private double average;
    private String grade;

    // Constructor
    public Student(String name, int rollNo, int tamil, int english, int maths, int science, int social) {
        this.name = name;
        this.rollNo = rollNo;
        this.tamil = tamil;
        this.english = english;
        this.maths = maths;
        this.science = science;
        this.social = social;

        calculateResults();
    }

    // Calculate total, average, grade
    private void calculateResults() {
        total = tamil + english + maths + science + social;
        average = total / 5.0;

        if (average >= 90) grade = "A";
        else if (average >= 80) grade = "B";
        else if (average >= 70) grade = "C";
        else if (average >= 60) grade = "D";
        else grade = "E";
    }

    // Getters
    public int getRollNo() { return rollNo; }
    public String getName() { return name; }

    // Update marks
    public void updateMarks(int tamil, int english, int maths, int science, int social) {
        this.tamil = tamil;
        this.english = english;
        this.maths = maths;
        this.science = science;
        this.social = social;
        calculateResults();
    }

    // Display details in table format
    public void display() {
        System.out.printf("%-10d %-15s %-6d %-6.1f %-6s\n",
                rollNo, name, total, average, grade);
    }

    // Convert to file format
    public String toFile() {
        return rollNo + "," + name + "," + tamil + "," + english + "," + maths + "," +
                science + "," + social;
    }

    // Create Student from file data
    public static Student fromFile(String line) {
        String[] p = line.split(",");
        return new Student(
                p[1],
                Integer.parseInt(p[0]),
                Integer.parseInt(p[2]),
                Integer.parseInt(p[3]),
                Integer.parseInt(p[4]),
                Integer.parseInt(p[5]),
                Integer.parseInt(p[6])
        );
    }
}

public class StudentManagementSystem {
    static ArrayList<Student> students = new ArrayList<>();
    static Scanner sc = new Scanner(System.in);
    static final String FILE_NAME = "students.txt";

    public static void main(String[] args) {
        loadData();

        while (true) {
            System.out.println("\n===== Student Management System =====");
            System.out.println("1. Add Student");
            System.out.println("2. Delete Student");
            System.out.println("3. Update Student");
            System.out.println("4. Search Student");
            System.out.println("5. Display All");
            System.out.println("6. Save & Exit");
            System.out.print("Choose option: ");

            int choice = sc.nextInt();
            sc.nextLine();

            switch (choice) {
                case 1 -> addStudent();
                case 2 -> deleteStudent();
                case 3 -> updateStudent();
                case 4 -> searchStudent();
                case 5 -> displayAll();
                case 6 -> {
                    saveData();
                    System.out.println("Data Saved. Exiting...");
                    return;
                }
                default -> System.out.println("Invalid option!");
            }
        }
    }

    // 1. Add student
    static void addStudent() {
        System.out.print("Enter Name: ");
        String name = sc.nextLine();

        System.out.print("Enter Roll No: ");
        int roll = sc.nextInt();

        System.out.println("Enter 5 Subject Marks:");
        System.out.print("Tamil: "); int t = sc.nextInt();
        System.out.print("English: "); int e = sc.nextInt();
        System.out.print("Maths: "); int m = sc.nextInt();
        System.out.print("Science: "); int s = sc.nextInt();
        System.out.print("Social: "); int so = sc.nextInt();

        students.add(new Student(name, roll, t, e, m, s, so));
        System.out.println("Student Added Successfully!");
    }

    // 2. Delete student
    static void deleteStudent() {
        System.out.print("Enter Roll No to Delete: ");
        int roll = sc.nextInt();

        students.removeIf(stu -> stu.getRollNo() == roll);
        System.out.println("Deleted Successfully (if existed).");
    }

    // 3. Update student marks
    static void updateStudent() {
        System.out.print("Enter Roll No to Update: ");
        int roll = sc.nextInt();

        for (Student stu : students) {
            if (stu.getRollNo() == roll) {
                System.out.println("Enter New Marks:");
                System.out.print("Tamil: "); int t = sc.nextInt();
                System.out.print("English: "); int e = sc.nextInt();
                System.out.print("Maths: "); int m = sc.nextInt();
                System.out.print("Science: "); int s = sc.nextInt();
                System.out.print("Social: "); int so = sc.nextInt();

                stu.updateMarks(t, e, m, s, so);
                System.out.println("Updated Successfully!");
                return;
            }
        }
        System.out.println("Student Not Found!");
    }

    // 4. Search student
    static void searchStudent() {
        System.out.print("Enter Roll No to Search: ");
        int roll = sc.nextInt();

        for (Student stu : students) {
            if (stu.getRollNo() == roll) {
                System.out.println("\nROLLNO     NAME            TOTAL  AVG    GRADE");
                stu.display();
                return;
            }
        }
        System.out.println("Student Not Found!");
    }

    // 5. Display all students
    static void displayAll() {
        System.out.println("\nROLLNO     NAME            TOTAL  AVG    GRADE");
        for (Student stu : students) stu.display();
    }

    // Save to file
    static void saveData() {
        try {
            PrintWriter pw = new PrintWriter(new FileWriter(FILE_NAME));
            for (Student s : students) pw.println(s.toFile());
            pw.close();
        } catch (Exception e) {
            System.out.println("Error Saving File!");
        }
    }

    // Load from file
    static void loadData() {
        try {
            File f = new File(FILE_NAME);
            if (!f.exists()) return;

            Scanner fileScanner = new Scanner(f);
            while (fileScanner.hasNextLine()) {
                String line = fileScanner.nextLine();
                students.add(Student.fromFile(line));
            }
        } catch (Exception e) {
            System.out.println("Error Loading File!");
        }
    }
}
